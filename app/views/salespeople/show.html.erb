<div class="page-header">
  <h3>Salesperson: <%= @salesperson.salesperson %>
      <!--<a href="/salespeople" class="btn-xs btn-primary pull-right">-->
      <!--  Back-->
      <!--</a>-->
      <a href="/salespeople/<%= @salesperson.id %>/edit" class="btn-xs btn-warning pull-right">
        Edit
      </a>
      <!--<a href="/delete_salesperson/<%= @salesperson.id %>" class="btn-xs btn-danger pull-right" rel="nofollow">-->
      <!--  Delete-->
      <!--</a> -->
  </h3>
</div>

<ul class="nav nav-tabs nav-justified">
  <li role="presentation" class="active"><a href="/salespeople/<%= @salesperson.id %>"><%=@salesperson.salesperson%>'s Customers</a></li>
  <li role="presentation"><a href="/salespeople/<%= @salesperson.id %>/recent">Recent Quotes</a></li>
  <li role="presentation"><a href="#">Notes & Contact</a></li> 
</ul>  

<div class="row">
  <div class="col-md-12">
    <table class="table table-striped table-hover">
      <tr>
        <th></th>
        <th></th>
        <th colspan="4" class="text-center">Tons Quoted Since July</th>
      </tr>
      <tr>
        <th>Customer</th>
        <th>Last Quoted</th>
        <th>NH3</th>
        <th>Urea</th>
        <th>UAN</th>
        <th>AN</th>
      </tr>
 
      <% Blockchain.select(:customer_id).where(salesperson_id: @salesperson.id).distinct.each do |blockchain| %>
      <tr>
        <td><a href="/customers/<%=blockchain.customer_id%>"><%= Customer.find(blockchain.customer_id).short_name %> (<%= Customer.find(blockchain.customer_id).promise_id %>)</a></td> 
        <td><%= time_ago_in_words(Blockchain.where(customer_id: blockchain.customer_id).minimum(:created_at)) %> ago</td>
        <td><%= number_with_delimiter(Blockchain.where(customer_id: blockchain.customer_id, product_id: 1).sum("tons").round) %></td>   
        <td><%= number_with_delimiter(Blockchain.where(customer_id: blockchain.customer_id, product_id: 2).sum("tons").round) %></td>  
        <td><%= number_with_delimiter(Blockchain.where(customer_id: blockchain.customer_id, product_id: 3).sum("tons").round) %></td>  
        <td><%= number_with_delimiter(Blockchain.where(customer_id: blockchain.customer_id, product_id: 4).sum("tons").round) %></td>  
      </tr>
      <% end %>
    </table>
  </div>
</div>
